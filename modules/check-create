#!/bin/bash

if [ "${mode_create}" == "kvm" ]
	then	if [ -n "${config_server_current}" ]
			then	probe=$(ssh ${config_server_current}${config_port_current} "qm list | grep ${sync_vmid_current}")
			else	probe=$(qm list | grep ${sync_vmid_current})
		fi

		if [ ! -n "${probe}" ]
			then	exit 80
		fi

	elif [ "${mode_create}" == "mysql" ] || [ "${mode_create}" == "pgsql" ]
		then	config_sql_credentials=$(echo ${config_options_sql} | cut -d " " -f 1)
			config_sql_certificate=$(echo ${config_options_sql} | cut -d " " -f 2)

			if [ "${mode_create}" == "mysql" ]
				then	if [ -n "${config_server_current}" ]
						then	probe=$(ssh ${config_server_current}${config_port_current} "find ${config_sql_credentials} -maxdepth 0 2> /dev/null")
						else	probe=$(find ${config_sql_credentials} -maxdepth 0 2> /dev/null)
					fi

					if [ ! "${probe}" == "${config_sql_credentials}" ]
						then	exit 91
					fi

					if [ -n "${config_server_current}" ]
						then	probe=$(ssh ${config_server_current}${config_port_current} "mysqlshow --defaults-extra-file=${config_sql_credentials} | grep ${sync_name_source_current} | awk '{ print $2 }'")
						else	probe=$(mysqlshow --defaults-extra-file=${config_sql_credentials} | grep ${sync_name_source_current} | awk '{ print $2 }')
					fi

					if [ ! "${probe}" == "${sync_name_source_current}" ]
						then	exit 93
					fi

				elif [ "${mode_create}" == "pgsql" ]
					then	if [ -n "${config_server_current}" ]
							then	probe=$(ssh ${config_server_current}${config_port_current} "find /root/.pgpass -maxdepth 0 2> /dev/null")
							else	probe=$(find /root/.pgpass -maxdepth 0 2> /dev/null)
						fi

					if [ ! "${probe}" == "/root/.pgpass" ]
						then	exit 91
					fi

					if [ -n "${config_server_current}" ]
						then	probe=$(ssh ${config_server_current}${config_port_current} "psql -l -U ${config_sql_credentials} -h localhost | grep ${sync_name_source_current} | awk '{ print $1 }")
						else	probe=$(psql -l -U ${config_sql_credentials} -h localhost | grep ${sync_name_source_current} | awk '{ print $1 }')
					fi

					if [ ! "${probe}" == "${sync_name_source_current}" ]
						then	exit 93
					fi
			fi

			if [ -n "${config_sql_certificate}" ]
				then	if [ -n "${config_server_current}" ]
						then	probe=$(ssh ${config_server_current}${config_port_current} "find ${config_sql_certificate} -maxdepth 0 2> /dev/null")
						else	probe=$(find ${config_sql_certificate} -maxdepth 0 2> /dev/null)
					fi

					if [ ! -n "${probe}" ]
						then	exit 92
					fi
			fi


	else	:
fi